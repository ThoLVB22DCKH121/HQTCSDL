<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Quản lý nhân viên</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { padding: 24px; background: #f8fafc; font-family: 'Segoe UI', Arial, sans-serif; }
        .container { max-width: 1100px; margin: 0 auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 12px rgba(30,41,59,0.07); padding: 24px; }
        h1 { color: #2563eb; margin-bottom: 24px; }
        .search-bar { margin-bottom: 18px; display: flex; gap: 8px; }
        .table th { background: #2563eb; color: #fff; }
        .pagination-btn { margin: 0 4px; padding: 2px 10px; border-radius: 4px; border: 1px solid #2563eb; background: #fff; color: #2563eb; cursor: pointer; }
        .pagination-btn:disabled { background: #e5e7eb; color: #94a3b8; cursor: not-allowed; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.2); align-items: center; justify-content: center; }
        .modal.show { display: flex; }
        .modal-content { background: #fff; border-radius: 8px; padding: 24px; min-width: 340px; max-width: 95vw; }
        .modal-header { font-weight: 700; color: #2563eb; margin-bottom: 12px; }
        .close-btn { float: right; font-size: 20px; color: #888; cursor: pointer; }
    </style>
</head>
<body>
<div class="container">
    <h1>Quản lý nhân viên</h1>
    <div class="search-bar">
        <input id="searchInput" class="form-control" style="max-width: 220px;" placeholder="Tìm kiếm theo tên, sđt...">
        <button class="btn btn-primary" onclick="searchEmployees()">Tìm kiếm</button>
        <button class="btn btn-success" onclick="showAddModal()">Thêm nhân viên</button>
    </div>
    <table class="table table-bordered" id="employeeTable">
        <thead><tr><th>Mã NV</th><th>Tên nhân viên</th><th>SĐT</th><th>Địa chỉ</th><th>Chức vụ</th><th>Hành động</th></tr></thead>
        <tbody></tbody>
    </table>
    <div style="display: flex; justify-content: center; margin: 12px 0;">
        <button id="prevBtn" class="pagination-btn">Trước</button>
        <span id="pageInfo" style="line-height: 28px; color: #2563eb; font-weight: 600; margin: 0 8px;"></span>
        <button id="nextBtn" class="pagination-btn">Sau</button>
    </div>
</div>
<!-- Modal Thêm/Sửa -->
<div class="modal" id="employeeModal">
    <div class="modal-content">
        <div class="modal-header">
            <span id="modalTitle">Thêm nhân viên</span>
            <span class="close-btn" onclick="closeModal()">&times;</span>
        </div>
        <form id="employeeForm" onsubmit="return saveEmployee()">
            <input type="hidden" id="employeeId">
            <div class="mb-2">
                <label>Tên nhân viên</label>
                <input id="employeeName" class="form-control" required>
            </div>
            <div class="mb-2">
                <label>Số điện thoại</label>
                <input id="employeePhone" class="form-control" required>
            </div>
            <div class="mb-2">
                <label>Địa chỉ</label>
                <input id="employeeAddress" class="form-control" required>
            </div>
            <div class="mb-2">
                <label>Chức vụ</label>
                <input id="employeePosition" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary">Lưu</button>
        </form>
    </div>
</div>
<script>
let page = 0, size = 5, totalPages = 1, keyword = '';
let employees = [];

function fetchEmployees() {
    fetch(`/api/employee?page=${page}&size=${size}&keyword=${encodeURIComponent(keyword)}`)
        .then(res => res.json())
        .then(data => {
            employees = data.content;
            totalPages = data.totalPages;
            renderEmployees();
        });
}
function renderEmployees() {
    const tbody = document.querySelector('#employeeTable tbody');
    tbody.innerHTML = employees.length ? employees.map(e => `<tr>
        <td>${e.employeeId}</td>
        <td>${e.employeeName}</td>
        <td>${e.phone}</td>
        <td>${e.address}</td>
        <td>${e.position || ''}</td>
        <td>
            <button class='btn btn-info btn-sm' onclick='showEditModal("${e.employeeId}")'>Sửa</button>
        </td>
    </tr>`).join('') : `<tr><td colspan="6" style="color:#64748b;">Không có dữ liệu</td></tr>`;
    document.getElementById('pageInfo').textContent = `${page + 1}/${Math.max(1, totalPages)}`;
    document.getElementById('prevBtn').disabled = page === 0;
    document.getElementById('nextBtn').disabled = page + 1 >= totalPages;
}
function searchEmployees() {
    keyword = document.getElementById('searchInput').value.trim();
    page = 0;
    fetchEmployees();
}
function showAddModal() {
    document.getElementById('modalTitle').textContent = 'Thêm nhân viên';
    document.getElementById('employeeId').value = '';
    document.getElementById('employeeName').value = '';
    document.getElementById('employeePhone').value = '';
    document.getElementById('employeeAddress').value = '';
    document.getElementById('employeePosition').value = '';
    document.getElementById('employeeModal').classList.add('show');
}
function showEditModal(id) {
    const e = employees.find(x => x.employeeId === id);
    if (!e) return;
    document.getElementById('modalTitle').textContent = 'Sửa nhân viên';
    document.getElementById('employeeId').value = e.employeeId;
    document.getElementById('employeeName').value = e.employeeName;
    document.getElementById('employeePhone').value = e.phone;
    document.getElementById('employeeAddress').value = e.address;
    document.getElementById('employeePosition').value = e.position || '';
    document.getElementById('employeeModal').classList.add('show');
}
function closeModal() {
    document.getElementById('employeeModal').classList.remove('show');
}
function saveEmployee() {
    const id = document.getElementById('employeeId').value;
    const name = document.getElementById('employeeName').value.trim();
    const phone = document.getElementById('employeePhone').value.trim();
    const address = document.getElementById('employeeAddress').value.trim();
    const position = document.getElementById('employeePosition').value.trim();
    const method = id ? 'PUT' : 'POST';
    const url = id ? `/api/employee/${id}` : '/api/employee';
    fetch(url, {
        method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ employeeName: name, phone, address, position })
    })
    .then(res => res.json())
    .then(() => {
        closeModal();
        fetchEmployees();
    });
    return false;
}
document.getElementById('prevBtn').onclick = function() { if (page > 0) { page--; fetchEmployees(); } };
document.getElementById('nextBtn').onclick = function() { if (page + 1 < totalPages) { page++; fetchEmployees(); } };
fetchEmployees();
</script>
